*** Begin Patch
*** Update File: components/revenue-schedule-supporting-details.tsx
@@
-"use client"
-
-import { useEffect, useMemo, useState } from "react"
-import {
-  PiggyBank,
-  BriefcaseBusiness,
-  Package,
-  Coins,
-  CreditCard,
-  NotebookPen,
-  Search,
-  Settings2,
-  Filter
-} from "lucide-react"
-import type { LucideIcon } from "lucide-react"
-
-import type { RevenueScheduleDetailRecord } from "./revenue-schedule-details-view"
+"use client"
+
+import { useCallback, useEffect, useMemo, useRef, useState } from "react"
+import {
+  PiggyBank,
+  BriefcaseBusiness,
+  Package,
+  Coins,
+  CreditCard,
+  NotebookPen,
+  Settings2
+} from "lucide-react"
+import type { LucideIcon } from "lucide-react"
+
+import type { RevenueScheduleDetailRecord } from "./revenue-schedule-details-view"
+import { ListHeader, type ColumnFilter } from "@/components/list-header"
+import { ColumnChooserModal } from "@/components/column-chooser-modal"
+import { DynamicTable, type Column, type PaginationInfo } from "@/components/dynamic-table"
+import { useTablePreferences } from "@/hooks/useTablePreferences"
+import { applySimpleFilters } from "@/lib/filter-utils"
+// Reuse the opportunity activities column definitions for parity
+import { ACTIVITY_TABLE_BASE_COLUMNS } from "@/components/opportunity-details-view"
@@
 const placeholder = <span className="text-slate-300">--</span>
@@
 export function RevenueScheduleSupportingDetails({ schedule }: { schedule: RevenueScheduleDetailRecord }) {
   const [activeSectionId, setActiveSectionId] = useState<string>(SECTION_ITEMS[0].id)
+  // ----------------------
+  // Activities table state
+  // ----------------------
+  const [activitiesLoading, setActivitiesLoading] = useState<boolean>(false)
+  const [activitiesError, setActivitiesError] = useState<string | null>(null)
+  const [activities, setActivities] = useState<any[]>([])
+  const [activitiesPagination, setActivitiesPagination] = useState<PaginationInfo>({ page: 1, pageSize: 10, total: 0, totalPages: 1 })
+  const [activitiesPage, setActivitiesPage] = useState<number>(1)
+  const [activitiesPageSize, setActivitiesPageSize] = useState<number>(10)
+  const [activitiesSearch, setActivitiesSearch] = useState<string>("")
+  const [activitiesIncludeCompleted, setActivitiesIncludeCompleted] = useState<boolean>(false) // false = Active
+  const [activitiesColumnFilters, setActivitiesColumnFilters] = useState<ColumnFilter[]>([])
+  const [selectedActivityIds, setSelectedActivityIds] = useState<string[]>([])
+  const searchDebounceRef = useRef<NodeJS.Timeout | null>(null)
+
+  // Activities filter columns
+  const RS_ACTIVITY_FILTER_COLUMNS: Array<{ id: string; label: string }> = useMemo(() => [
+    { id: "activityDate", label: "Activity Date" },
+    { id: "activityType", label: "Activity Type" },
+    { id: "activityStatus", label: "Activity Status" },
+    { id: "description", label: "Description" },
+    { id: "activityOwner", label: "Activity Owner" },
+    { id: "createdBy", label: "Created By" }
+  ], [])
+
+  // Format date as YYYY/MM/DD to match existing detail views
+  const formatDate = useCallback((value?: string | Date | null): string => {
+    if (!value) return "--"
+    const date = value instanceof Date ? value : new Date(value)
+    if (Number.isNaN(date.getTime())) return "--"
+    const y = date.getFullYear()
+    const m = String(date.getMonth() + 1).padStart(2, "0")
+    const d = String(date.getDate()).padStart(2, "0")
+    return ${y}//
+  }, [])
+
+  // Persisted column prefs specific to RS activities
+  const RS_ACTIVITY_BASE_COLUMNS: Column[] = useMemo(() => ACTIVITY_TABLE_BASE_COLUMNS.map(col => ({ ...col })), [])
+  const {
+    columns: activityPrefColumns,
+    handleColumnsChange: handleActivityColumnsChange,
+  } = useTablePreferences("revenue-schedule:activities", RS_ACTIVITY_BASE_COLUMNS)
+
+  const activityColumnsWithRender = useMemo<Column[]>(() => {
+    return activityPrefColumns.map(column => {
+      if (column.id === "activityDate") {
+        return { ...column, render: (value?: string | Date | null) => formatDate(value) }
+      }
+      return column
+    })
+  }, [activityPrefColumns, formatDate])
+
+  const mapApiRowToActivity = useCallback((row: any) => {
+    const attachments = Array.isArray(row.attachments) ? row.attachments : []
+    const attachmentCount = attachments.length
+    const attachmentLabel = attachmentCount === 0 ? "None" : ${attachmentCount} file
+    const primaryFileName = attachmentCount > 0 ? attachments[0]?.fileName ?? null : null
+
+    // Prefer dueDate, fallback to createdAt
+    const dateValue: string | Date | null = row.dueDate ?? row.createdAt ?? null
+
+    return {
+      id: row.id,
+      active: !!row.active,
+      activityDate: dateValue,
+      activityType: row.type ?? null,
+      activityStatus: row.status ?? null,
+      description: row.description ?? row.subject ?? null,
+      activityOwner: row.assigneeName ?? null,
+      createdBy: row.creatorName ?? null,
+      attachment: attachmentLabel,
+      fileName: primaryFileName,
+      attachments
+    }
+  }, [])
+
+  const fetchActivities = useCallback(async () => {
+    if (!schedule?.id) {
+      setActivities([])
+      setActivitiesPagination({ page: 1, pageSize: activitiesPageSize, total: 0, totalPages: 1 })
+      return
+    }
+
+    setActivitiesLoading(true)
+    setActivitiesError(null)
+    try {
+      const params = new URLSearchParams({
+        page: String(activitiesPage),
+        pageSize: String(activitiesPageSize),
+        contextType: "RevenueSchedule",
+        contextId: String(schedule.id),
+        includeCompleted: activitiesIncludeCompleted ? "true" : "false",
+        sortBy: "dueDate",
+        sortDirection: "desc",
+      })
+      if (activitiesSearch.trim()) {
+        params.set("search", activitiesSearch.trim())
+      }
+
+      const response = await fetch(/api/activities?, { cache: "no-store" })
+      const payload = await response.json().catch(() => null)
+      if (!response.ok) {
+        throw new Error(payload?.error ?? "Failed to load activities")
+      }
+
+      const data: any[] = Array.isArray(payload?.data) ? payload.data : []
+      const pagination: PaginationInfo = payload?.pagination ?? { page: activitiesPage, pageSize: activitiesPageSize, total: data.length, totalPages: 1 }
+      const mapped = data.map(mapApiRowToActivity)
+
+      setActivities(mapped)
+      setActivitiesPagination(pagination)
+      // Keep selections that still exist on current page
+      setSelectedActivityIds(prev => prev.filter(id => mapped.some(row => row.id === id)))
+    } catch (err) {
+      console.error("Failed to load schedule activities", err)
+      setActivities([])
+      setActivitiesPagination({ page: 1, pageSize: activitiesPageSize, total: 0, totalPages: 1 })
+      setActivitiesError(err instanceof Error ? err.message : "Unable to load activities")
+    } finally {
+      setActivitiesLoading(false)
+    }
+  }, [schedule?.id, activitiesPage, activitiesPageSize, activitiesSearch, activitiesIncludeCompleted, mapApiRowToActivity])
+
+  // Initial + param-triggered loads
+  useEffect(() => {
+    void fetchActivities()
+  }, [fetchActivities])
+
+  // Debounce search for better UX
+  const handleSearch = useCallback((query: string) => {
+    setActivitiesSearch(query)
+    setActivitiesPage(1)
+    if (searchDebounceRef.current) clearTimeout(searchDebounceRef.current)
+    searchDebounceRef.current = setTimeout(() => {
+      void fetchActivities()
+    }, 250)
+  }, [fetchActivities])
+
+  const handleStatusFilter = useCallback((filter: string) => {
+    const includeCompleted = filter !== "active"
+    setActivitiesIncludeCompleted(includeCompleted)
+    setActivitiesPage(1)
+  }, [])
+
+  const handleActivitiesPageChange = useCallback((page: number) => {
+    setActivitiesPage(page)
+  }, [])
+
+  const handleActivitiesPageSizeChange = useCallback((size: number) => {
+    setActivitiesPageSize(size)
+    setActivitiesPage(1)
+  }, [])
+
+  const handleActivityItemSelect = useCallback((itemId: string, selected: boolean) => {
+    setSelectedActivityIds(prev => selected ? Array.from(new Set([...prev, itemId])) : prev.filter(id => id !== itemId))
+  }, [])
+
+  const handleSelectAllActivities = useCallback((selected: boolean) => {
+    if (selected) {
+      setSelectedActivityIds(activities.map(row => row.id))
+    } else {
+      setSelectedActivityIds([])
+    }
+  }, [activities])
+
+  // Apply client-side column filters on the current page
+  const filteredActivities = useMemo(() => applySimpleFilters(activities, activitiesColumnFilters), [activities, activitiesColumnFilters])
@@
-  const renderActivitiesNotes = () => (
-    <div className="space-y-3">
-      <div className="flex flex-wrap items-center gap-2">
-        <div className="relative">
-          <Search className="pointer-events-none absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-slate-400" />
-          <input
-            className="h-8 rounded-full border border-slate-300 bg-white px-8 text-[11px] text-slate-700 placeholder:text-slate-400 focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-100"
-            placeholder="Search Here"
-            type="search"
-          />
-        </div>
-        <div className="flex flex-wrap items-center gap-2">
-          <select className="h-8 rounded-full border border-slate-300 bg-white px-3 text-[11px] text-slate-700 focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-100">
-            <option>Filter By Column</option>
-            <option>Activity Date</option>
-            <option>Activity Type</option>
-          </select>
-          <button
-            type="button"
-            className="inline-flex h-8 items-center rounded-full bg-primary-600 px-3 text-[11px] font-semibold text-white shadow-sm transition hover:bg-primary-700"
-          >
-            <Filter className="mr-2 h-3.5 w-3.5" />
-            Apply Filter
-          </button>
-          <button
-            aria-label="More filter options"
-            type="button"
-            className="inline-flex h-8 w-8 items-center justify-center rounded-full border border-slate-300 bg-white text-slate-500 shadow-sm transition hover:border-primary-200 hover:text-primary-600"
-          >
-            <Settings2 className="h-3.5 w-3.5" />
-          </button>
-        </div>
-        <div className="ml-auto flex items-center gap-2 rounded-full border border-slate-200 bg-slate-100 p-1">
-          <button
-            type="button"
-            className="rounded-full bg-primary-600 px-3 py-0.5 text-[11px] font-semibold text-white shadow-sm transition hover:bg-primary-700"
-          >
-            Active
-          </button>
-          <button
-            type="button"
-            className="rounded-full px-3 py-0.5 text-[11px] font-semibold text-slate-600 transition hover:bg-white"
-          >
-            Show All
-          </button>
-        </div>
-      </div>
-      <div className="overflow-x-auto">
-        <table className="w-full min-w-[720px] overflow-hidden rounded-2xl border border-slate-200 text-[11px]">
-          <thead className="bg-indigo-100 text-indigo-700">
-            <tr>
-              {["Actions", "Active", "Activity Date", "Activity ID", "Activity Type", "Description", "Attachment"].map(header => (
-                <th key={header} className="px-2 py-1.5 text-left text-[11px] font-semibold uppercase tracking-wide">
-                  {header}
-                </th>
-              ))}
-            </tr>
-          </thead>
-          <tbody className="bg-white text-slate-600">
-            <tr>
-              <td className="px-2 py-4 text-center text-[11px]" colSpan={7}>
-                No data available in table
-              </td>
-            </tr>
-          </tbody>
-        </table>
-      </div>
-      <div className="flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500">
-        <div className="flex items-center gap-3">
-          <button className="text-primary-600 transition hover:text-primary-700" type="button">
-            Previous
-          </button>
-          <button className="text-primary-600 transition hover:text-primary-700" type="button">
-            Next
-          </button>
-        </div>
-        <div className="flex items-center gap-2">
-          <span>Showing 0 to 0 of 0 entries</span>
-          <label className="flex items-center gap-2">
-            <span>Show</span>
-            <select className="rounded border border-slate-300 bg-white px-2 py-1 text-[11px]">
-              <option>10</option>
-              <option>25</option>
-              <option>50</option>
-            </select>
-            <span>entries</span>
-          </label>
-        </div>
-        <button
-          type="button"
-          className="inline-flex items-center rounded-full bg-primary-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm transition hover:bg-primary-700"
-        >
-          Create New
-        </button>
-      </div>
-    </div>
-  )
+  const renderActivitiesNotes = () => (
+    <div className="space-y-3">
+      <ListHeader
+        pageTitle="Activities & Notes"
+        searchPlaceholder="Search activities"
+        onSearch={handleSearch}
+        onFilterChange={handleStatusFilter}
+        filterColumns={RS_ACTIVITY_FILTER_COLUMNS}
+        columnFilters={activitiesColumnFilters}
+        onColumnFiltersChange={setActivitiesColumnFilters}
+        onSettingsClick={() => setColumnChooserOpen(true)}
+        showCreateButton={true}
+        onCreateClick={() => {/* wired later with revenue-schedule modal */}}
+      />
+
+      <div className="rounded-3xl border border-slate-200 bg-white p-2 shadow-inner">
+        <DynamicTable
+          columns={activityColumnsWithRender}
+          data={filteredActivities}
+          loading={activitiesLoading}
+          emptyMessage={activitiesError ?? "No data available in table"}
+          onColumnsChange={handleActivityColumnsChange}
+          pagination={activitiesPagination}
+          onPageChange={handleActivitiesPageChange}
+          onPageSizeChange={handleActivitiesPageSizeChange}
+          selectedItems={selectedActivityIds}
+          onItemSelect={(id, selected) => handleActivityItemSelect(id, selected)}
+          onSelectAll={handleSelectAllActivities}
+          alwaysShowPagination={true}
+          fillContainerWidth={true}
+          maxBodyHeight={360}
+          hideSelectAllLabel={false}
+          selectHeaderLabel="Select All"
+        />
+      </div>
+
+      <ColumnChooserModal
+        isOpen={columnChooserOpen}
+        columns={activityColumnsWithRender}
+        onApply={handleActivityColumnsChange}
+        onClose={async () => {
+          setColumnChooserOpen(false)
+        }}
+      />
+    </div>
+  )
@@
   let sectionContent: React.ReactNode
@@
   return (
     <section className="rounded-3xl border border-slate-200 bg-white p-2 shadow-sm">
       <div className="grid gap-2 xl:grid-cols-[260px,1fr]">
         <nav className="flex flex-col gap-1.5 rounded-3xl bg-slate-100 p-2">
@@
-        <div className="rounded-3xl border border-slate-200 bg-white p-3 shadow-inner">
+        <div className="rounded-3xl border border-slate-200 bg-white p-3 shadow-inner">
           {sectionContent ?? <p className="text-[11px] text-slate-500">Select a section to view its details.</p>}
         </div>
       </div>
     </section>
   )
 }
*** End Patch